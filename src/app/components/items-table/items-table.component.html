<div class="mat-elevation-z8 table-responsive">
  <table mat-table matSort [dataSource]="dataSource" class="items-table">
    <ng-container matColumnDef="client">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Client</th>
      <td mat-cell *matCellDef="let item">
        <ng-container *ngIf="item.client && item.client.firstName && item.client.lastName; else undefinedInfo">
          {{ item.client.firstName }} {{ item.client.lastName }}
        </ng-container>
        
      </td>
    </ng-container>

    <ng-container matColumnDef="phone">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Téléphone</th>
      <td mat-cell *matCellDef="let item">
        <ng-container *ngIf="item.client && item.client.phone; else undefinedInfo">
          {{ item.client.phone | phoneFormat }}
        </ng-container>
      </td>
    </ng-container>

    <ng-container matColumnDef="bikeDescription">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>
        Description vélo
      </th>
      <td mat-cell *matCellDef="let item">
        <ng-container *ngIf="item.bikeDescription; else undefinedInfo">
          {{ item.bikeDescription }}
        </ng-container>
      </td>
    </ng-container>

    <ng-container matColumnDef="product">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Produit</th>
      <td mat-cell *matCellDef="let item">
        <ng-container *ngIf="item.expenses[0] && item.expenses[0].name; else undefinedInfo">
          {{ item.expenses[0].name }}
        </ng-container>
      </td>
    </ng-container>

    <ng-container matColumnDef="unitPrice">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Prix unitaire</th>
      <td mat-cell *matCellDef="let item">
        <ng-container *ngIf="item.expenses[0] && item.expenses[0].price >= 0 ; else undefinedInfo">
          {{ item.expenses[0].price | currency }}
        </ng-container>
      </td>
    </ng-container>

    <ng-container matColumnDef="quantity">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Quantité</th>
      <td mat-cell *matCellDef="let item">
        <ng-container *ngIf="item.expenses[0] && item.expenses[0].quantity; else undefinedInfo">
          {{ item.expenses[0].quantity }}
        </ng-container>
      </td>
    </ng-container>

    <ng-container matColumnDef="provider">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Fournisseur</th>
      <td mat-cell *matCellDef="let item">
        <ng-container *ngIf="item.expenses[0] && item.expenses[0].provider && item.expenses[0].provider.name; else undefinedInfo">
          {{ item.expenses[0].provider.name }}
        </ng-container>
      </td>
    </ng-container>

    <ng-container matColumnDef="color">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Couleur</th>
      <td mat-cell *matCellDef="let item">
        <ng-container *ngIf="item.color; else undefinedInfo">
          {{ item.color }}
        </ng-container>
      </td>
    </ng-container>

    <ng-container matColumnDef="status">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Statut</th>
      <td mat-cell *matCellDef="let item">{{ item.status }}</td>
    </ng-container>

    <ng-container matColumnDef="deliveryDate">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>
        Date livraison
      </th>
      <td mat-cell *matCellDef="let item">
        {{ item.deliveryDate | date: "dd/M/yy" }}
      </td>
    </ng-container>

    <ng-container matColumnDef="creationDate">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>
        Date création
      </th>
      <td mat-cell *matCellDef="let item">
        {{ item.createdAt | date: "dd/M/yy" }}
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
    <tr
      mat-row
      *matRowDef="let row; columns: displayedColumns"
      (click)="selectItem(row)"
      [class.selected-row]="selectedItem == row"
    ></tr>
  </table>

  <ng-container *ngIf="!(isLoading$ | async) && items.length === 0">
      <p class="message">Aucune réparation</p>
  </ng-container>
  <ng-container *ngIf="(isLoading$ | async)">
    <app-loader></app-loader>
</ng-container>
  <ng-container *ngIf="displayLoadMoreHistory$ | async">
    <p (click)="loadMoreHistory()" class="message load-more-history">Afficher plus</p>
</ng-container>
</div>

<ng-template #undefinedInfo>
  Non défini
</ng-template>