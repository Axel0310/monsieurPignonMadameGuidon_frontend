<form [formGroup]="newRepairForm" (input)="onRepairFormChange()">
  <table formArrayName="expenses">
    <thead>
      <th></th>
      <th>Produits/Service</th>
      <th>Prix</th>
      <th>Quantité</th>
    </thead>
    <tbody>
      <tr *ngFor="let expense of expenses.controls; let i = index">
        <ng-container [formGroupName]="i">
          <td>
            <fa-icon
              [icon]="faTrashAlt"
              (click)="removeExpense(i)"
              class="delete-icon"
            ></fa-icon>
          </td>
          <td>
            <mat-form-field appearance="fill">
              <input matInput formControlName="name" required />
            </mat-form-field>
          </td>
          <td>
            <mat-form-field appearance="fill" class="number-input">
              <input matInput type="number" formControlName="price" required (change)="updateTotalPrice()"/>
            </mat-form-field>
          </td>
          <td>
            <mat-form-field appearance="fill" class="number-input">
              <input
                matInput
                type="number"
                formControlName="quantity"
                required
                (change)="updateTotalPrice()"
              />
            </mat-form-field>
          </td>
        </ng-container>
      </tr>
      <tr>
        <td colspan="4" class="total-price">Total: {{totalPrice | currency}}</td>
      </tr>
    </tbody>
  </table>

  <p (click)="addExpense()" class="new-line">+ Ajouter un produit</p>

  <div class="other-inputs">
    <div>
      <mat-form-field appearance="fill" class="input">
        <mat-label>Statut</mat-label>
        <select matNativeControl formControlName="status" required>
          <option value="A faire">A faire</option>
          <option value="Fait">Fait</option>
          <option value="Client notifié">Client notifié</option>
          <option value="Livré">Livré</option>
        </select>
      </mat-form-field>

      <mat-form-field appearance="fill" class="input">
        <mat-label>Localisation</mat-label>
        <select matNativeControl formControlName="localization" required>
          <option value="En boutique">En boutique</option>
          <option value="Attente pièce">Attente pièce</option>
          <option value="Entrepôt">Entrepôt</option>
        </select>
      </mat-form-field>
    </div>

    <div>
      <!-- <mat-form-field appearance="fill" class="input">
        <mat-label>Date de livraison estimée</mat-label>
        <input
          matInput
          [matDatepicker]="picker"
          [min]="minDate"
          formControlName="targetDeliveryDate"
          required
        />
        <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
        <mat-datepicker #picker></mat-datepicker>
      </mat-form-field> -->
      <mat-form-field>
        <mat-label>Date de livraison</mat-label>
        <input matInput [ngxMatDatetimePicker]="picker" formControlName="targetDeliveryDate"
           [min]="minDate" required>
        <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
        <ngx-mat-datetime-picker #picker [showSeconds]="false" [stepMinute]="30">
        </ngx-mat-datetime-picker>
     </mat-form-field>

      <mat-form-field appearance="fill" class="input">
        <mat-label>Description vélo</mat-label>
        <input matInput formControlName="bikeDescription" required />
      </mat-form-field>

      <mat-form-field appearance="fill" class="input">
        <mat-label>Référence facture</mat-label>
        <input matInput formControlName="billRef" required />
      </mat-form-field>
    </div>

    <div>
      <mat-form-field appearance="fill" class="input">
        <mat-label>Commentaire</mat-label>
        <input matInput formControlName="comment" />
      </mat-form-field>

      <mat-form-field appearance="fill" class="input">
        <mat-label>V+1</mat-label>
        <input matInput formControlName="commercialOpportunity" />
      </mat-form-field>
    </div>
  </div>
</form>
